{% extends 'admin/base.html.twig' %}

{% block title %}Statistiques RÃ©clamations{% endblock %}

{% block body %}
<div class="container my-5">

    <!-- ðŸ”™ Boutons haut de page -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{{ path('reclamation_index') }}" class="btn btn-outline-black rounded-pill text-dark">
            â¬… Retour Ã  la gestion des rÃ©clamations
        </a>

        <a href="{{ path('reclamation_stats_pdf') }}" class="btn btn-outline-danger rounded-pill text-dark">
            ðŸ“„ Exporter en PDF
        </a>
    </div>

    <!-- ðŸ§¾ Titre -->
    <h2 class="text-center mb-4">ðŸ“Š Statistiques des rÃ©clamations</h2>

    <!-- ðŸ§© SÃ©lecteur de type de graphique -->
    <div class="mb-4 text-center">
        <label for="chartType" class="form-label fw-bold mb-2">Choisir le type de graphique :</label>
        <select id="chartType" class="form-select w-auto mx-auto rounded-pill">
            <option value="bar" selected>Barres</option>
            <option value="pie">Camembert</option>
            <option value="doughnut">Donut</option>
            <option value="line">Lignes</option>
        </select>
    </div>

    <!-- ðŸ“ˆ Graphique -->
    <canvas id="reclamationChart" height="100"></canvas>

</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js') }}"></script>

<script>
    const ctx = document.getElementById('reclamationChart').getContext('2d');

    // ðŸ“Š DonnÃ©es de base
    const data = {
        labels: ['En attente', 'En cours', 'FermÃ©e'],
        datasets: [{
            label: 'Nombre de rÃ©clamations',
            data: [
                {{ counts['En attente'] }},
                {{ counts['En cours'] }},
                {{ counts['FermÃ©e'] }}
            ],
            backgroundColor: ['#f1c40f', '#3498db', '#2ecc71']
        }]
    };

    // ðŸ§© Options de base
    const options = {
        responsive: true,
        plugins: {
            legend: { 
             position: 'top',
            onClick:()=> {}
            },
            title: {
                display: true,
                text: 'RÃ©partition des statuts',
                color: '#333',
                font: { size: 18 }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { precision: 0 }
            }
        }
    };

    // ðŸ“ˆ Initialisation du graphique
    let chart = new Chart(ctx, {
        type: 'bar', // par dÃ©faut
        data: data,
        options: options
    });

    // ðŸ”¥ Quand on change le type de graphique
    document.getElementById('chartType').addEventListener('change', function() {
        const selectedType = this.value;
        chart.destroy(); // DÃ©truire l'ancien graphique
        chart = new Chart(ctx, {
            type: selectedType,
            data: data,
            options: options
        });
    });
</script>
{% endblock %}