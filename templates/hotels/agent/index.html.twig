{% extends 'base.html.twig' %}

{% block title %}Gestion des Hôtels{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    .hotel-container {
        padding: 2rem;
    }
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }
    .page-title {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .badge-count {
        background-color: #6c757d;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.875rem;
    }
    .btn-create {
        background-color: #28a745;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .btn-create:hover {
        background-color: #218838;
        color: white;
    }
    .search-filter-container {
        background-color: #f8f9fa;
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 2rem;
    }
    .search-box {
        position: relative;
        margin-bottom: 1rem;
    }
    .search-box i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
    }
    .search-box input {
        padding-left: 2.5rem;
    }
    .filter-section {
        margin-top: 1.5rem;
    }
    .filter-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    .stars-filter, .agency-filter {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    .hotel-card {
        border: none;
        border-radius: 0.5rem;
        overflow: hidden;
        transition: transform 0.2s;
        height: 100%;
    }
    .hotel-card:hover {
        transform: translateY(-5px);
    }
    .hotel-image {
        height: 200px;
        object-fit: cover;
    }
    .hotel-stars {
        font-size: 0.875rem;
    }
    .hotel-price {
        font-size: 1.25rem;
        font-weight: 600;
        color: #28a745;
    }
    .action-buttons {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    .btn-view, .btn-edit, .btn-delete {
        padding: 0.375rem 0.75rem;
        border-radius: 0.25rem;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .btn-view {
        background-color: #17a2b8;
        color: white;
    }
    .btn-edit {
        background-color: #ffc107;
        color: #212529;
    }
    .btn-delete {
        background-color: #dc3545;
        color: white;
    }
    .no-hotels {
        text-align: center;
        padding: 3rem;
        background-color: #f8f9fa;
        border-radius: 0.5rem;
    }
    .alert {
        margin-bottom: 1rem;
    }
    .alert-success {
        background-color: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
    }
    .alert-danger {
        background-color: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
    }
</style>
{% endblock %}

{% block body %}
<div class="hotel-container">
    {% for message in app.flashes('success') %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}

    {% for message in app.flashes('error') %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}

    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-hotel"></i> Liste des Hôtels
            <span class="badge-count" id="hotelCount">{{ hotels|length }}</span>
        </h1>
        <a href="{{ path('app_hotel_action', {'action': 'new'}) }}" class="btn-create">
            <i class="fas fa-plus"></i> Nouvel Hôtel
        </a>
    </div>

    <div class="search-filter-container">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" class="form-control" placeholder="Rechercher par nom ou localisation..." 
                   value="{{ search|default('') }}">
        </div>
        
        <div class="filter-section">
            <div class="filter-title">Filtrer par étoiles:</div>
            <div class="stars-filter">
                {% for i in 1..5 %}
                    <input type="checkbox" class="stars-checkbox" id="stars-{{ i }}" 
                           value="{{ i }}"
                           {% if i in selected_stars %}checked{% endif %}>
                    <label for="stars-{{ i }}" class="stars-label">
                        {% for j in 1..i %}
                            <i class="fas fa-star"></i>
                        {% endfor %}
                    </label>
                {% endfor %}
            </div>
            
            <div class="filter-title">Filtrer par agence:</div>
            <div class="agency-filter">
                {% for agency in all_agencies %}
                    <input type="checkbox" class="agency-checkbox" id="agency-{{ agency.id }}" 
                           value="{{ agency.id }}"
                           {% if agency.id in selected_agencies|map(v => v|number_format) %}checked{% endif %}>
                    <label for="agency-{{ agency.id }}" class="agency-label">
                        {{ agency.name }}
                    </label>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="row" id="hotelsContainer">
        {% include 'hotels/agent/_hotels_list.html.twig' %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const starsCheckboxes = document.querySelectorAll('.stars-checkbox');
    const agencyCheckboxes = document.querySelectorAll('.agency-checkbox');
    const hotelsContainer = document.getElementById('hotelsContainer');
    const badgeCount = document.getElementById('hotelCount');

    function loadResults() {
        const params = new URLSearchParams();
        if (searchInput.value) params.append('search', searchInput.value);
        
        const selectedStars = Array.from(starsCheckboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);
        if (selectedStars.length) params.append('stars[]', selectedStars);
        
        const selectedAgencies = Array.from(agencyCheckboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);
        if (selectedAgencies.length) params.append('agencies[]', selectedAgencies);

        fetch(`{{ path('app_hotel_index') }}?${params.toString()}`, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Accept': 'text/html'
            }
        })
        .then(response => response.text())
        .then(html => {
            hotelsContainer.innerHTML = html;
            updateHotelCount();
        });
    }

    function updateHotelCount() {
        const hotelCount = document.querySelectorAll('#hotelsContainer .col-md-4').length;
        badgeCount.textContent = hotelCount;
    }

    searchInput.addEventListener('input', function() {
        clearTimeout(this.timer);
        this.timer = setTimeout(loadResults, 300);
    });

    starsCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', loadResults);
    });

    agencyCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', loadResults);
    });

    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('search') || urlParams.has('stars') || urlParams.has('agencies')) {
        loadResults();
    }
});
</script>
{% endblock %} 